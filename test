#!/bin/sh

export GOPATH=$PWD/
export GOMAXPROCS=1


# Abort on errors after this point ...
set -e


echo ""
echo ".................................................................."
echo "Installing dependencies .........................................."
echo ".................................................................."
echo ""

go get "github.com/fzzy/radix/redis"
go get "github.com/alecthomas/log4go"
go get "github.com/jessevdk/go-flags"
go get "github.com/bradfitz/gomemcache/memcache"
go get "github.com/jteeuwen/go-bindata"
go get "github.com/orfjackal/gospec/src/gospec"
go get "github.com/samuel/go-thrift/thrift"
go get "github.com/samuel/go-thrift/generator"
go get "github.com/samuel/go-thrift/parser"
go get "github.com/sdming/goh"
go get -u "github.com/gnagel/dog_pool/dog_pool" # This package!


echo ""
echo ".................................................................."
echo "Formatting the code .............................................."
echo ".................................................................."
gofmt -s -w $GOPATH/dog_pool
echo ""


echo ""
echo ".................................................................."
echo "Running tests ...................................................."
echo ".................................................................."
echo ""

go test -bench=".*" ./dog_pool/... || exit $?

echo ""
echo ".................................................................."
echo "Finished tests ..................................................."
echo ".................................................................."
echo ""
